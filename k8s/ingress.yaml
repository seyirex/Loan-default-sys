apiVersion: networking.k8s.io/v1
kind: Ingress
metadata:
  name: loan-prediction-ingress
  namespace: loan-default-prediction
  labels:
    app: loan-default-prediction
  annotations:
    # Nginx Ingress Controller annotations
    nginx.ingress.kubernetes.io/rewrite-target: /$2
    nginx.ingress.kubernetes.io/ssl-redirect: "true"
    nginx.ingress.kubernetes.io/force-ssl-redirect: "true"

    # Rate limiting (optional)
    nginx.ingress.kubernetes.io/limit-rps: "100"

    # CORS settings (if needed)
    nginx.ingress.kubernetes.io/enable-cors: "true"
    nginx.ingress.kubernetes.io/cors-allow-methods: "GET, POST, PUT, DELETE, OPTIONS"
    nginx.ingress.kubernetes.io/cors-allow-origin: "*"

    # Request size limit (for large batch predictions)
    nginx.ingress.kubernetes.io/proxy-body-size: "50m"

    # Timeouts for long-running predictions
    nginx.ingress.kubernetes.io/proxy-connect-timeout: "300"
    nginx.ingress.kubernetes.io/proxy-send-timeout: "300"
    nginx.ingress.kubernetes.io/proxy-read-timeout: "300"

    # For cloud providers:
    # AWS ALB:
    # kubernetes.io/ingress.class: alb
    # alb.ingress.kubernetes.io/scheme: internet-facing
    # alb.ingress.kubernetes.io/target-type: ip

    # GCP GKE:
    # kubernetes.io/ingress.class: gce
    # kubernetes.io/ingress.global-static-ip-name: "your-static-ip"
spec:
  ingressClassName: nginx  # Change based on your ingress controller

  # TLS Configuration (optional but recommended for production)
  tls:
    - hosts:
        - loan-api.yourdomain.com
        - mlflow.yourdomain.com
      secretName: loan-prediction-tls  # Create this secret with your TLS cert

  rules:
    # API Endpoint
    - host: loan-api.yourdomain.com  # Replace with your domain
      http:
        paths:
          - path: /
            pathType: Prefix
            backend:
              service:
                name: loan-api
                port:
                  number: 80

    # MLflow UI Endpoint
    - host: mlflow.yourdomain.com  # Replace with your domain
      http:
        paths:
          - path: /
            pathType: Prefix
            backend:
              service:
                name: mlflow-service
                port:
                  number: 5000

    # Alternative: Single domain with path-based routing
    # Uncomment if you prefer paths over subdomains
    # - host: yourdomain.com
    #   http:
    #     paths:
    #       - path: /api(/|$)(.*)
    #         pathType: ImplementationSpecific
    #         backend:
    #           service:
    #             name: loan-api
    #             port:
    #               number: 80
    #       - path: /mlflow(/|$)(.*)
    #         pathType: ImplementationSpecific
    #         backend:
    #           service:
    #             name: mlflow-service
    #             port:
    #               number: 5000
